<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAHADA FOOD - واجهة الموظف</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- استيراد خدمة الطباعة وخدمة الطلبات -->
    <script src="print-service.js"></script>
    <script src="order-service.js"></script>
    <style>
        :root {
            --primary-color: #8B4513;
            --primary-dark: #5D2906;
            --primary-light: #A05D2E;
            --secondary-color: #4caf50;
            --background-dark: #121212;
            --background-paper: #1e1e1e;
            --border-color: #333;
            --border-radius: 12px;
            --box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--background-dark);
            color: white;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .app-bar {
            background-color: var(--primary-color);
            padding: 12px 20px;
            display: flex;
            align-items: center;
        }

        .back-button {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            margin-left: 15px;
        }

        .app-title {
            font-size: 20px;
            font-weight: 600;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-right: auto;
        }

        #user-name {
            font-weight: 500;
            color: #ddd;
        }

        .logout-button {
            background-color: transparent;
            color: #ddd;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .logout-button:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .cashier-container {
            display: flex;
            height: calc(100vh - 56px);
        }

        .menu-section {
            flex: 3;
            padding: 20px;
            overflow-y: auto;
        }

        .order-section {
            flex: 2;
            padding: 20px;
            background-color: var(--background-paper);
            border-right: 1px solid var(--border-color);
        }

        .menu-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
        }

        .category-chip {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 18px 15px;
            background-color: white;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: calc(20% - 12px);
            min-width: 90px;
            border: 1px solid #eee;
            color: #333;
        }

        .category-chip:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            border-color: var(--primary-color);
        }

        .category-chip.active {
            background-color: var(--primary-color);
            color: white;
        }

        .category-chip.active i {
            color: white;
        }

        .category-chip.active span {
            color: white;
        }

        .category-chip i {
            font-size: 28px;
            color: var(--primary-color);
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .category-chip span {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            text-align: center;
            transition: all 0.3s ease;
        }

        .menu-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
        }

        .menu-item {
            background-color: var(--background-paper);
            border-radius: var(--border-radius);
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            animation: fadeIn 0.5s ease-out;
            animation-fill-mode: both;
        }

        .menu-item:hover {
            transform: scale(1.05);
        }

        .menu-item-image {
            height: 140px;
            background-color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            position: relative;
            overflow: hidden;
            border-radius: 8px 8px 0 0;
        }

        .menu-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .menu-item:hover .menu-item-image img {
            transform: scale(1.1);
        }

        .menu-item-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--primary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .menu-item-content {
            padding: 16px;
        }

        .menu-item-title {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .menu-item-price {
            color: #aaa;
        }

        .order-title {
            font-size: 20px;
            margin-bottom: 16px;
        }

        .customer-form {
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #ddd;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group label i {
            margin-left: 5px;
            color: var(--primary-color);
        }

        .toggle-container {
            display: flex;
            align-items: center;
            margin-top: 5px;
        }

        .toggle-input {
            display: none;
        }

        .toggle-label {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            background-color: #555;
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .toggle-label:after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: white;
            top: 2px;
            left: 2px;
            transition: var(--transition);
        }

        .toggle-input:checked + .toggle-label {
            background-color: var(--primary-color);
        }

        .toggle-input:checked + .toggle-label:after {
            left: 28px;
        }

        .toggle-text {
            margin-right: 10px;
            font-size: 14px;
            color: #ddd;
        }

        .printer-config {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .printer-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .printer-option label {
            font-size: 14px;
            color: #ddd;
            margin-bottom: 0;
        }

        .form-select {
            width: 120px;
            padding: 6px 10px;
            background-color: #333;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: white;
            font-family: 'Tajawal', 'Cairo', sans-serif;
        }

        .customer-input {
            width: 100%;
            padding: 12px;
            background-color: #333;
            border: 1px solid #444;
            border-radius: 8px;
            color: white;
            font-family: 'Tajawal', 'Cairo', sans-serif;
            transition: all 0.3s ease;
        }

        .customer-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(255, 152, 0, 0.2);
            outline: none;
        }

        .divider {
            height: 1px;
            background-color: var(--border-color);
            margin: 16px 0;
        }

        .empty-cart {
            text-align: center;
            color: #aaa;
            margin: 40px 0;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
            animation: slideIn 0.3s ease-out;
            animation-fill-mode: both;
            transition: var(--transition);
        }

        .cart-item:hover {
            background-color: rgba(139, 69, 19, 0.1);
            padding-right: 10px;
            border-radius: 8px;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 500;
        }

        .cart-item-price {
            color: #aaa;
            font-size: 14px;
        }

        .cart-item-actions {
            display: flex;
            align-items: center;
        }

        .quantity-button {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            background-color: #333;
            color: white;
            cursor: pointer;
        }

        .quantity-text {
            margin: 0 10px;
        }

        .remove-button {
            margin-right: 10px;
            background: none;
            border: none;
            color: #f44336;
            cursor: pointer;
            font-size: 18px;
        }

        .total-section {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            font-size: 18px;
            font-weight: 600;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .action-button {
            flex: 1;
            padding: 12px;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Tajawal', 'Cairo', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .checkout-button {
            background-color: var(--primary-color);
        }

        .checkout-button:hover:not(:disabled) {
            background-color: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .checkout-button:active:not(:disabled) {
            animation: pulse 0.3s ease-in-out;
        }

        .clear-button {
            background-color: #f44336;
        }

        .clear-button:hover {
            background-color: #d32f2f;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .send-button {
            background-color: #e67e22;
            color: white;
        }

        .send-button:hover:not(:disabled) {
            background-color: #d35400;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .send-button:active:not(:disabled) {
            animation: pulse 0.3s ease-in-out;
        }

        .print-buttons {
            display: flex;
            gap: 10px;
        }

        .print-button, .pdf-button {
            flex: 1;
            padding: 10px;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Tajawal', 'Cairo', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .print-button {
            background-color: #2196f3;
        }

        .print-button:hover:not(:disabled) {
            background-color: #1976d2;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .print-button:active:not(:disabled) {
            animation: pulse 0.3s ease-in-out;
        }

        .pdf-button {
            background-color: #4caf50;
        }

        .pdf-button:hover:not(:disabled) {
            background-color: #388e3c;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .pdf-button:active:not(:disabled) {
            animation: pulse 0.3s ease-in-out;
        }

        .action-button:disabled, .print-button:disabled, .pdf-button:disabled {
            background-color: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--background-paper);
            border-radius: 8px;
            padding: 20px;
            width: 400px;
            max-width: 90%;
        }

        .modal-title {
            font-size: 20px;
            margin-bottom: 15px;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
        }

        .modal-button {
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
        }

        .primary-button {
            background-color: var(--primary-color);
            color: white;
        }

        .secondary-button {
            background-color: #555;
            color: white;
            margin-right: 10px;
        }

        .secondary-button:hover {
            background-color: #444;
        }
    </style>
</head>
<body>
    <div class="app-bar">
        <button class="back-button" onclick="window.location.href='index-static.html'">←</button>
        <div class="app-title">MAHADA FOOD - واجهة الموظف</div>
        <div class="user-info">
            <span id="user-name">مستخدم</span>
            <button class="logout-button" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
            </button>
        </div>
    </div>

    <div class="cashier-container">
        <div class="menu-section">
            <div class="menu-categories">
                <button class="category-chip active" onclick="filterCategory('all')">
                    <i class="fas fa-th-large"></i>
                    <span>الكل</span>
                </button>
                <button class="category-chip" onclick="filterCategory('sandwiches')">
                    <i class="fas fa-hamburger"></i>
                    <span>ساندويتشات</span>
                </button>
                <button class="category-chip" onclick="filterCategory('meals')">
                    <i class="fas fa-utensils"></i>
                    <span>وجبات</span>
                </button>
                <button class="category-chip" onclick="filterCategory('drinks')">
                    <i class="fas fa-glass-whiskey"></i>
                    <span>مشروبات</span>
                </button>
                <button class="category-chip" onclick="filterCategory('desserts')">
                    <i class="fas fa-ice-cream"></i>
                    <span>حلويات</span>
                </button>
            </div>

            <div class="menu-items">
                <!-- ساندويتشات -->
                <div class="menu-item" data-category="sandwiches" onclick="addToCart(1, 'شاورما دجاج', 350)">
                    <div class="menu-item-image">
                        <img src="https://images.unsplash.com/photo-1550547660-d9450f859349?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="شاورما دجاج">
                        <div class="menu-item-badge">الأكثر مبيعاً</div>
                    </div>
                    <div class="menu-item-content">
                        <div class="menu-item-title">شاورما دجاج</div>
                        <div class="menu-item-price">350 دج</div>
                    </div>
                </div>

                <div class="menu-item" data-category="sandwiches" onclick="addToCart(2, 'شاورما لحم', 400)">
                    <div class="menu-item-image">
                        <img src="https://images.unsplash.com/photo-1633321702518-7feccafb94d5?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="شاورما لحم">
                    </div>
                    <div class="menu-item-content">
                        <div class="menu-item-title">شاورما لحم</div>
                        <div class="menu-item-price">400 دج</div>
                    </div>
                </div>

                <div class="menu-item" data-category="sandwiches" onclick="addToCart(3, 'برجر لحم', 450)">
                    <div class="menu-item-image">
                        <img src="https://images.unsplash.com/photo-1568901346375-23c9450c58cd?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="برجر لحم">
                    </div>
                    <div class="menu-item-content">
                        <div class="menu-item-title">برجر لحم</div>
                        <div class="menu-item-price">450 دج</div>
                    </div>
                </div>

                <!-- مشروبات -->
                <div class="menu-item" data-category="drinks" onclick="addToCart(6, 'عصير برتقال', 200)">
                    <div class="menu-item-image">
                        <img src="https://images.unsplash.com/photo-1600271886742-f049cd451bba?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="عصير برتقال">
                    </div>
                    <div class="menu-item-content">
                        <div class="menu-item-title">عصير برتقال</div>
                        <div class="menu-item-price">200 دج</div>
                    </div>
                </div>

                <div class="menu-item" data-category="drinks" onclick="addToCart(9, 'مياه معدنية', 80)">
                    <div class="menu-item-image">
                        <img src="https://images.unsplash.com/photo-1548839140-29a749e1cf4d?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="مياه معدنية">
                    </div>
                    <div class="menu-item-content">
                        <div class="menu-item-title">مياه معدنية</div>
                        <div class="menu-item-price">80 دج</div>
                    </div>
                </div>

                <!-- وجبات -->
                <div class="menu-item" data-category="meals" onclick="addToCart(4, 'طبق شاورما مشكل', 650)">
                    <div class="menu-item-image">
                        <img src="https://images.unsplash.com/photo-1529006557810-274b9b2fc783?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="طبق شاورما مشكل">
                        <div class="menu-item-badge">جديد</div>
                    </div>
                    <div class="menu-item-content">
                        <div class="menu-item-title">طبق شاورما مشكل</div>
                        <div class="menu-item-price">650 دج</div>
                    </div>
                </div>

                <!-- حلويات -->
                <div class="menu-item" data-category="desserts" onclick="addToCart(5, 'كنافة', 300)">
                    <div class="menu-item-image">
                        <img src="https://images.unsplash.com/photo-1579954115545-a95591f28bfc?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80" alt="كنافة">
                    </div>
                    <div class="menu-item-content">
                        <div class="menu-item-title">كنافة</div>
                        <div class="menu-item-price">300 دج</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="order-section">
            <h2 class="order-title">الطلب الحالي</h2>

            <div class="customer-form">
                <div class="form-group">
                    <label for="customerName"><i class="fas fa-user"></i> اسم الزبون</label>
                    <input type="text" id="customerName" class="customer-input" placeholder="الاسم الكامل للزبون">
                </div>
                <div class="form-group">
                    <label for="customerPhone"><i class="fas fa-phone"></i> رقم الهاتف (اختياري)</label>
                    <input type="text" id="customerPhone" class="customer-input" placeholder="رقم هاتف الزبون">
                </div>
                <div class="form-group">
                    <label for="cashierName"><i class="fas fa-id-card"></i> اسم الكاشير</label>
                    <select id="cashierName" class="customer-input">
                        <option value="محمد">محمد</option>
                        <option value="أحمد">أحمد</option>
                        <option value="فاطمة">فاطمة</option>
                        <option value="عائشة">عائشة</option>
                        <option value="خالد">خالد</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="autoPrint"><i class="fas fa-print"></i> طباعة تلقائية</label>
                    <div class="toggle-container">
                        <input type="checkbox" id="autoPrint" class="toggle-input" checked>
                        <label for="autoPrint" class="toggle-label"></label>
                        <span class="toggle-text">تفعيل الطباعة التلقائية للمطبخ</span>
                    </div>
                </div>

                <div class="form-group">
                    <label><i class="fas fa-cog"></i> إعدادات الطابعة</label>
                    <div class="printer-config">
                        <div class="printer-option">
                            <label for="cashierPrinter">طابعة الكاشير</label>
                            <select id="cashierPrinter" class="form-select">
                                <option value="1" selected>طابعة 1</option>
                                <option value="2">طابعة 2</option>
                            </select>
                        </div>
                        <div class="printer-option">
                            <label for="kitchenPrinter">طابعة المطبخ</label>
                            <select id="kitchenPrinter" class="form-select">
                                <option value="1">طابعة 1</option>
                                <option value="2" selected>طابعة 2</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="divider"></div>

            <div id="empty-cart" class="empty-cart">
                لم يتم إضافة أي عناصر بعد
            </div>

            <div id="cart-items" style="display: none;">
                <!-- سيتم إضافة العناصر هنا بواسطة JavaScript -->
            </div>

            <div class="divider"></div>

            <div class="total-section">
                <span>المجموع:</span>
                <span id="total-price">0 دج</span>
            </div>

            <div class="action-buttons">
                <button id="clear-button" class="action-button clear-button" onclick="clearOrder()">
                    <i class="fas fa-trash"></i> مسح الطلب
                </button>

                <button id="send-to-kitchen-button" class="action-button send-button" disabled onclick="sendToKitchen()">
                    <i class="fas fa-utensils"></i> إرسال للمطبخ
                </button>

                <button id="checkout-button" class="action-button checkout-button" disabled onclick="showOrderCompleteModal()">
                    <i class="fas fa-check-circle"></i> تأكيد الطلب
                </button>
            </div>

            <div class="print-buttons">
                <button id="print-button" class="print-button" disabled onclick="printCurrentOrder()">
                    <i class="fas fa-print"></i> طباعة
                </button>

                <button id="pdf-button" class="pdf-button" disabled onclick="generatePDF()">
                    <i class="fas fa-file-pdf"></i> تحميل PDF
                </button>
            </div>

            <!-- نافذة تأكيد الطلب -->
            <div id="order-complete-modal" class="modal">
                <div class="modal-content">
                    <h2 class="modal-title">تم إكمال الطلب بنجاح</h2>
                    <div class="modal-body">
                        <p>تم إنشاء الطلب رقم <span id="order-number">19</span> بنجاح</p>
                        <p id="confirmation-text" style="color: #aaa; margin-top: 10px;">تم إرسال الطلب إلى المطبخ وطباعة الفاتورة</p>
                    </div>
                    <div class="modal-actions">
                        <button class="modal-button primary-button" onclick="startNewOrder()">طلب جديد</button>
                        <button class="modal-button secondary-button" onclick="document.getElementById('order-complete-modal').style.display = 'none'">العودة للطلب</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // التحقق من تسجيل الدخول
        window.addEventListener('load', function() {
            const currentUser = localStorage.getItem('currentUser');

            if (!currentUser) {
                // إذا لم يكن المستخدم مسجل الدخول، توجيهه إلى صفحة تسجيل الدخول
                window.location.href = 'login.html';
                return;
            }

            const user = JSON.parse(currentUser);

            // التحقق من نوع المستخدم
            if (user.type !== 'cashier' && user.type !== 'admin') {
                alert('ليس لديك صلاحية للوصول إلى هذه الصفحة');
                window.location.href = 'login.html';
                return;
            }

            // عرض اسم المستخدم في الواجهة
            document.getElementById('user-name').textContent = user.fullName;

            // تعيين اسم الكاشير تلقائياً
            const cashierSelect = document.getElementById('cashierName');
            for (let i = 0; i < cashierSelect.options.length; i++) {
                if (cashierSelect.options[i].value === user.username) {
                    cashierSelect.selectedIndex = i;
                    break;
                }
            }

            // تعطيل تغيير اسم الكاشير
            cashierSelect.disabled = true;
        });

        // تسجيل الخروج
        function logout() {
            if (confirm('هل أنت متأكد من رغبتك في تسجيل الخروج؟')) {
                localStorage.removeItem('currentUser');
                window.location.href = 'login.html';
            }
        }

        // متغيرات عامة
        let cart = [];
        let orderNumber = 19;

        // إضافة منتج إلى السلة
        function addToCart(id, name, price) {
            const existingItem = cart.find(item => item.id === id);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id,
                    name,
                    price,
                    quantity: 1
                });
            }

            updateCartUI();
        }

        // تحديث كمية منتج في السلة
        function updateQuantity(id, change) {
            const item = cart.find(item => item.id === id);
            if (item) {
                item.quantity = Math.max(1, item.quantity + change);
                updateCartUI();
            }
        }

        // إزالة منتج من السلة
        function removeItem(id) {
            cart = cart.filter(item => item.id !== id);
            updateCartUI();
        }

        // حساب المجموع
        function calculateTotal() {
            return cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        }

        // تحديث واجهة السلة
        function updateCartUI() {
            const emptyCartElement = document.getElementById('empty-cart');
            const cartItemsElement = document.getElementById('cart-items');
            const totalPriceElement = document.getElementById('total-price');
            const checkoutButton = document.getElementById('checkout-button');
            const sendToKitchenButton = document.getElementById('send-to-kitchen-button');

            // تحديث حالة السلة (فارغة أو تحتوي على عناصر)
            if (cart.length === 0) {
                emptyCartElement.style.display = 'block';
                cartItemsElement.style.display = 'none';
                checkoutButton.disabled = true;
                sendToKitchenButton.disabled = true;
            } else {
                emptyCartElement.style.display = 'none';
                cartItemsElement.style.display = 'block';
                checkoutButton.disabled = false;
                sendToKitchenButton.disabled = false;

                // إنشاء عناصر السلة
                cartItemsElement.innerHTML = '';
                cart.forEach(item => {
                    const cartItemElement = document.createElement('div');
                    cartItemElement.className = 'cart-item';
                    cartItemElement.innerHTML = `
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-price">${item.price} دج × ${item.quantity} = ${item.price * item.quantity} دج</div>
                        </div>
                        <div class="cart-item-actions">
                            <button class="quantity-button" onclick="updateQuantity(${item.id}, -1)">-</button>
                            <span class="quantity-text">${item.quantity}</span>
                            <button class="quantity-button" onclick="updateQuantity(${item.id}, 1)">+</button>
                            <button class="remove-button" onclick="removeItem(${item.id})">🗑️</button>
                        </div>
                    `;
                    cartItemsElement.appendChild(cartItemElement);
                });
            }

            // تحديث المجموع
            totalPriceElement.textContent = calculateTotal() + ' دج';

            // تحديث حالة أزرار الطباعة
            document.getElementById('print-button').disabled = cart.length === 0;
            document.getElementById('pdf-button').disabled = cart.length === 0;
        }

        // تصفية المنتجات حسب الفئة
        function filterCategory(category) {
            // تحديث حالة الأزرار
            const categoryButtons = document.querySelectorAll('.category-chip');
            categoryButtons.forEach(button => {
                button.classList.remove('active');
                if (button.textContent === getCategoryName(category)) {
                    button.classList.add('active');
                }
            });

            // تصفية المنتجات
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => {
                if (category === 'all' || item.dataset.category === category) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // الحصول على اسم الفئة بالعربية
        function getCategoryName(category) {
            switch (category) {
                case 'all': return 'الكل';
                case 'sandwiches': return 'ساندويتشات';
                case 'meals': return 'وجبات';
                case 'drinks': return 'مشروبات';
                case 'desserts': return 'حلويات';
                default: return '';
            }
        }

        // مسح الطلب الحالي
        function clearOrder() {
            if (cart.length === 0) {
                alert('السلة فارغة بالفعل!');
                return;
            }

            if (confirm('هل أنت متأكد من رغبتك في مسح جميع العناصر من السلة؟')) {
                cart = [];
                updateCartUI();
            }
        }

        // إظهار نافذة تأكيد الطلب
        function showOrderCompleteModal() {
            // إنشاء كائن الطلب
            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const cashierName = document.getElementById('cashierName').value;
            const autoPrint = document.getElementById('autoPrint').checked;

            if (!customerName) {
                alert('يرجى إدخال اسم الزبون الكامل');
                document.getElementById('customerName').focus();
                return;
            }

            const order = {
                orderNumber: orderNumber,
                customerName: customerName,
                customerPhone: customerPhone || 'غير متوفر',
                employee: cashierName,
                items: cart,
                createdAt: new Date().toISOString(),
                status: 'pending'
            };

            // حفظ الطلب الحالي في متغير عام
            currentOrder = order;

            // الحصول على إعدادات الطابعة
            const cashierPrinterId = document.getElementById('cashierPrinter').value;
            const kitchenPrinterId = document.getElementById('kitchenPrinter').value;

            // تكوين الطابعات
            const cashierPrinter = {
                name: 'طابعة الكاشير',
                id: parseInt(cashierPrinterId),
                description: 'طابعة الفواتير والتقارير'
            };

            const kitchenPrinter = {
                name: 'طابعة المطبخ',
                id: parseInt(kitchenPrinterId),
                description: 'طابعة طلبات المطبخ'
            };

            // طباعة الفاتورة وورقة المطبخ تلقائياً
            if (autoPrint) {
                try {
                    console.log('بدء طباعة الفاتورة وطلب المطبخ تلقائياً...');

                    // خيارات الطباعة
                    const printOptions = {
                        autoPrint: true,
                        maxRetries: 3,
                        silent: true // عدم عرض رسائل الخطأ (سيتم عرضها في نافذة التأكيد)
                    };

                    // طباعة الفاتورة على طابعة الكاشير
                    const receiptResult = printReceipt(order, cashierPrinter, printOptions);

                    if (receiptResult) {
                        console.log('تم إرسال الفاتورة للطباعة بنجاح');

                        // التحقق مما إذا تم استخدام الطريقة البديلة
                        if (receiptResult.fallback) {
                            console.log('تم استخدام الطريقة البديلة لطباعة الفاتورة');
                        }
                    } else {
                        console.error('فشل في طباعة الفاتورة');
                    }

                    // طباعة ورقة المطبخ على طابعة المطبخ
                    const kitchenResult = printKitchenOrder(order, kitchenPrinter, printOptions);

                    if (kitchenResult) {
                        console.log('تم إرسال طلب المطبخ للطباعة بنجاح');

                        // التحقق مما إذا تم استخدام الطريقة البديلة
                        if (kitchenResult.fallback) {
                            console.log('تم استخدام الطريقة البديلة لطباعة طلب المطبخ');
                        }
                    } else {
                        console.error('فشل في طباعة طلب المطبخ');
                    }
                } catch (error) {
                    console.error('خطأ أثناء الطباعة التلقائية:', error);
                }
            }

            // عرض نافذة تأكيد الطلب
            const modal = document.getElementById('order-complete-modal');
            document.getElementById('order-number').textContent = orderNumber;

            // تحديث نص التأكيد بناءً على حالة الطباعة التلقائية
            const confirmationText = document.getElementById('confirmation-text');
            if (autoPrint) {
                confirmationText.textContent = 'تم إرسال الطلب إلى المطبخ وطباعة الفاتورة تلقائياً';
            } else {
                confirmationText.textContent = 'يمكنك الآن طباعة الفاتورة يدوياً';
            }

            modal.style.display = 'flex';
        }

        // طباعة الطلب الحالي
        function printCurrentOrder() {
            if (cart.length === 0) {
                alert('لا يوجد عناصر في السلة للطباعة!');
                return;
            }

            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const cashierName = document.getElementById('cashierName').value;
            const autoPrint = document.getElementById('autoPrint').checked;

            if (!customerName) {
                alert('يرجى إدخال اسم الزبون الكامل');
                document.getElementById('customerName').focus();
                return;
            }

            const order = {
                orderNumber: orderNumber,
                customerName: customerName,
                customerPhone: customerPhone || 'غير متوفر',
                employee: cashierName,
                items: cart,
                createdAt: new Date().toISOString(),
                status: 'pending'
            };

            // الحصول على إعدادات الطابعة
            const cashierPrinterId = document.getElementById('cashierPrinter').value;
            const kitchenPrinterId = document.getElementById('kitchenPrinter').value;

            // تكوين الطابعات
            const cashierPrinter = {
                name: 'طابعة الكاشير',
                id: parseInt(cashierPrinterId),
                description: 'طابعة الفواتير والتقارير'
            };

            const kitchenPrinter = {
                name: 'طابعة المطبخ',
                id: parseInt(kitchenPrinterId),
                description: 'طابعة طلبات المطبخ'
            };

            try {
                console.log('بدء طباعة الطلب الحالي...');

                // خيارات الطباعة
                const printOptions = {
                    autoPrint: true,
                    maxRetries: 3
                };

                // طباعة الفاتورة على طابعة الكاشير
                const receiptResult = printReceipt(order, cashierPrinter, printOptions);

                if (receiptResult) {
                    console.log('تم إرسال الفاتورة للطباعة بنجاح');

                    // التحقق مما إذا تم استخدام الطريقة البديلة
                    if (receiptResult.fallback) {
                        console.log('تم استخدام الطريقة البديلة لطباعة الفاتورة');
                    }
                } else {
                    console.error('فشل في طباعة الفاتورة');
                    // رسالة الخطأ ستظهر تلقائياً من خلال وظيفة الطباعة
                }

                // طباعة ورقة المطبخ إذا كان التبديل مفعل
                if (autoPrint) {
                    // طباعة ورقة المطبخ على طابعة المطبخ
                    const kitchenResult = printKitchenOrder(order, kitchenPrinter, printOptions);

                    if (kitchenResult) {
                        console.log('تم إرسال طلب المطبخ للطباعة بنجاح');

                        // التحقق مما إذا تم استخدام الطريقة البديلة
                        if (kitchenResult.fallback) {
                            console.log('تم استخدام الطريقة البديلة لطباعة طلب المطبخ');
                        }
                    } else {
                        console.error('فشل في طباعة طلب المطبخ');
                        // رسالة الخطأ ستظهر تلقائياً من خلال وظيفة الطباعة
                    }
                }
            } catch (error) {
                console.error('خطأ أثناء طباعة الطلب الحالي:', error);
                alert('حدث خطأ أثناء الطباعة. يرجى المحاولة مرة أخرى.');
            }
        }

        // إنشاء ملف PDF
        function generatePDF() {
            if (cart.length === 0) {
                alert('لا يوجد عناصر في السلة لإنشاء PDF!');
                return;
            }

            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const cashierName = document.getElementById('cashierName').value;

            if (!customerName) {
                alert('يرجى إدخال اسم الزبون الكامل');
                document.getElementById('customerName').focus();
                return;
            }

            const order = {
                orderNumber: orderNumber,
                customerName: customerName,
                customerPhone: customerPhone || 'غير متوفر',
                employee: cashierName,
                items: cart,
                createdAt: new Date().toISOString(),
                status: 'pending'
            };

            try {
                console.log('بدء إنشاء ملف PDF...');

                // خيارات الطباعة
                const printOptions = {
                    autoPrint: false, // عدم الطباعة تلقائياً
                    maxRetries: 3
                };

                // استخدام طابعة الكاشير
                const printer = {
                    name: 'طابعة الكاشير',
                    id: parseInt(document.getElementById('cashierPrinter').value),
                    description: 'طابعة الفواتير والتقارير'
                };

                // إنشاء محتوى الفاتورة
                const receiptContent = generateReceiptContent(order);

                // فتح نافذة الطباعة مع تعطيل الطباعة التلقائية
                const printResult = openPrintWindow(receiptContent, 'فاتورة للتحميل', false, printer);

                if (printResult) {
                    // التحقق مما إذا تم استخدام الطريقة البديلة
                    if (printResult.fallback) {
                        console.log('تم استخدام الطريقة البديلة لإنشاء PDF');
                    }

                    // إضافة رسالة للمستخدم
                    alert('يرجى استخدام خيار "حفظ كـ PDF" أو "طباعة إلى PDF" من نافذة الطباعة لتحميل الفاتورة كملف PDF');
                } else {
                    console.error('فشل في فتح نافذة إنشاء PDF');
                    alert('حدث خطأ أثناء إنشاء ملف PDF. يرجى المحاولة مرة أخرى.');
                }
            } catch (error) {
                console.error('خطأ أثناء إنشاء ملف PDF:', error);
                alert('حدث خطأ أثناء إنشاء ملف PDF. يرجى المحاولة مرة أخرى.');
            }
        }

        // إرسال الطلب إلى المطبخ
        function sendToKitchen() {
            try {
                console.log('بدء إرسال الطلب إلى المطبخ...');

                // التحقق من وجود عناصر في السلة
                if (cart.length === 0) {
                    alert('لا يمكن إرسال طلب فارغ إلى المطبخ');
                    return;
                }

                // إنشاء كائن الطلب
                const customerName = document.getElementById('customerName').value || 'زبون';
                const customerPhone = document.getElementById('customerPhone').value || 'غير متوفر';
                const cashierName = document.getElementById('cashierName').value;

                const order = {
                    customerName: customerName,
                    customerPhone: customerPhone,
                    employee: cashierName,
                    items: [...cart], // نسخة من عناصر السلة
                    status: 'temp',
                    createdAt: new Date().toISOString()
                };

                // حفظ الطلب في التخزين المؤقت
                const savedOrder = saveTempOrder(order);

                // نقل الطلب إلى قائمة الطلبات المعلقة
                const movedOrder = moveOrderToPending(savedOrder.id);

                if (movedOrder) {
                    console.log('تم إرسال الطلب إلى المطبخ بنجاح:', movedOrder);

                    // طباعة ورقة المطبخ
                    const autoPrint = document.getElementById('autoPrint').checked;

                    if (autoPrint) {
                        // الحصول على إعدادات الطابعة
                        const kitchenPrinterId = document.getElementById('kitchenPrinter').value;

                        // تكوين الطابعة
                        const kitchenPrinter = {
                            name: 'طابعة المطبخ',
                            id: parseInt(kitchenPrinterId),
                            description: 'طابعة طلبات المطبخ'
                        };

                        // خيارات الطباعة
                        const printOptions = {
                            autoPrint: true,
                            maxRetries: 3,
                            silent: true
                        };

                        // طباعة ورقة المطبخ
                        const kitchenResult = printKitchenOrder(movedOrder, kitchenPrinter, printOptions);

                        if (kitchenResult) {
                            console.log('تم إرسال طلب المطبخ للطباعة بنجاح');
                        } else {
                            console.error('فشل في طباعة طلب المطبخ');
                        }
                    }

                    // عرض رسالة تأكيد
                    alert(`تم إرسال الطلب رقم ${movedOrder.orderNumber} إلى المطبخ بنجاح`);

                    // بدء طلب جديد
                    startNewOrder();
                } else {
                    console.error('فشل في نقل الطلب إلى قائمة الطلبات المعلقة');
                    alert('حدث خطأ أثناء إرسال الطلب إلى المطبخ. يرجى المحاولة مرة أخرى.');
                }
            } catch (error) {
                console.error('خطأ أثناء إرسال الطلب إلى المطبخ:', error);
                alert('حدث خطأ أثناء إرسال الطلب إلى المطبخ. يرجى المحاولة مرة أخرى.');
            }
        }

        // بدء طلب جديد
        function startNewOrder() {
            cart = [];
            orderNumber++;
            updateCartUI();
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('order-complete-modal').style.display = 'none';

            // الحفاظ على اسم الكاشير وإعدادات الطباعة التلقائية
            // لا نقوم بإعادة تعيين هذه القيم لتسهيل إدخال الطلبات المتتالية
        }

        // متغير عام لحفظ الطلب الحالي
        let currentOrder = null;
    </script>
</body>
</html>
